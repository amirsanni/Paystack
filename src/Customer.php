<?php
namespace amirsanni\paystacklib;

class Customer extends Master {
    public function __construct($secret_key){
        $this->secret_key = $secret_key;
    }

    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */

    public function create($email, $fn='', $ln='', $ph='', $md=''){
        //https://api.paystack.co/customer
        $url = 'https://api.paystack.co/customer';

        if($email){
            $response = json_decode($this->curl($url, TRUE, [
                'email'=>$email,
                'first_name'=>$fn,
                'last_name'=>$ln,
                'phone'=>$ph,
                'metadata'=>$md ? json_encode($md) : ''
            ]));
            
            if($response && $response->status){                
                //return customer_code and ID
                return ['customer_id'=>$response->data->id, 'customer_code'=>$response->data->customer_code];
            }
            
            //api request failed
            return FALSE;
        }

        return FALSE;
    }

    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */

    public function getOne($email_or_id_or_customer_code){
        //https://api.paystack.co/customer/:email_or_id_or_customer_code
        $url = "https://api.paystack.co/customer/{$email_or_id_or_customer_code}";
        
        //curl($url, $use_post, $post_data=[])
        return json_decode($this->curl($url, FALSE));
    }

    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */

    public function getMany($page_number=1, $per_page=50){
        //https://api.paystack.co/customer
        $url = "https://api.paystack.co/customer?page={$page_number}&perPage={$per_page}";
        
        //curl($url, $use_post, $post_data=[])
        return json_decode($this->curl($url, FALSE));
    }

    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */

    public function update($id_or_customer_code, $fn='', $ln='', $ph='', $md=''){
        //https://api.paystack.co/customer/:id_or_customer_code
        $url = "https://api.paystack.co/customer/{$id_or_customer_code}";

        $response = json_decode($this->curl($url, FALSE, [
            'first_name'=>$fn,
            'last_name'=>$ln,
            'phone'=>$ph,
            'metadata'=>$md ? json_encode($md) : ''
        ]), TRUE, "PUT");

        return $response;
    }

    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */

    public function whitelist($id_or_customer_code_or_email){
        //https://api.paystack.co/customer/set_risk_action
        $url = "https://api.paystack.co/customer/set_risk_action";

        $response = json_decode($this->curl($url, TRUE, [
            'customer'=>$id_or_customer_code_or_email,
            'risk_action'=>'allow'
        ]));

        return $response;
    }

    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */

    public function blacklist($id_or_customer_code_or_email){
        //https://api.paystack.co/customer/set_risk_action
        $url = "https://api.paystack.co/customer/set_risk_action";

        $response = json_decode($this->curl($url, TRUE, [
            'customer'=>$id_or_customer_code_or_email,
            'risk_action'=>'deny'
        ]));

        return $response;
    }
}