<?php
namespace amirsanni\paystacklib;

class Plan extends Master {
    public function __construct($secret_key){
        $this->secret_key = $secret_key;
    }

    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */

    public function create($data){
        //https://api.paystack.co/plan
        $url = 'https://api.paystack.co/plan';

        if($data['name'] && $data['amount'] && $data['interval']){
            $response = json_decode($this->curl($url, TRUE, [
                'name'=>$data['name'],
                'amount'=>$data['amount'],
                'interval'=>$data['interval'],
                'description'=>$data['description'],
                'send_invoices'=>$data['send_invoices'],
                'send_sms'=>$data['send_sms'],
                'currency'=>$data['currency'],
                'invoice_limit'=>$data['invoice_limit']
            ]));
            
            return $response ? $response : FALSE;
        }

        return ['status'=>0, 'msg'=>"One or more required fields are empty"];
    }

    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */

    public function getOne($id_or_plan_code){
        //https://api.paystack.co/plan/:id_or_plan_code
        $url = "https://api.paystack.co/plan/{$id_or_plan_code}";
        
        //curl($url, $use_post, $post_data=[])
        return json_decode($this->curl($url, FALSE));
    }

    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */

    public function getMany($page_number=1, $per_page=50){
        //https://api.paystack.co/plan
        $url = "https://api.paystack.co/plan?page={$page_number}&perPage={$per_page}";
        
        //curl($url, $use_post, $post_data=[])
        return json_decode($this->curl($url, FALSE));
    }

    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */

    public function update($id_or_plan_code, $data){
        //https://api.paystack.co/plan/:id_or_plan_code
        $url = "https://api.paystack.co/plan/{$id_or_plan_code}";

        $response = json_decode($this->curl($url, FALSE, [
            'name'=>$data['name'],
            'amount'=>$data['amount'],
            'interval'=>$data['interval'],
            'description'=>$data['description'],
            'send_invoices'=>$data['send_invoices'],
            'send_sms'=>$data['send_sms'],
            'currency'=>$data['currency'],
            'invoice_limit'=>$data['invoice_limit']
        ], TRUE, "PUT"));

        return $response;
    }
}